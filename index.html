<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AMS Order From</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA manifest + iOS support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007aff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icon-192.png">

  <!-- External styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <h1>AMS Order From</h1>

  <div class="card">
    <label for="customerName">Customer Name</label>
    <input id="customerName" type="text" placeholder="e.g. ABC Trucking" />
    <div id="customerSuggestions"></div>

    <div style="margin-top:0.3rem;">
      <button type="button" class="small-btn" onclick="openManageCustomers()">
        Manage customers
      </button>
    </div>

    <label for="shipTo" style="margin-top:0.6rem;">Ship To / Notes (optional)</label>
    <textarea id="shipTo" placeholder="Address, special instructions, etc."></textarea>

    <!-- New customer checkbox -->
    <div class="inline-checkbox">
      <input type="checkbox" id="newCustomer" />
      <label for="newCustomer" style="margin:0;">Include account details (new customer)</label>
    </div>

    <!-- Customer details (for warehouse email only; not saved) -->
    <div id="newCustomerDetails" style="display:none; margin-top:0.75rem;">
      <div class="two-column">
        <!-- Shipping Address -->
        <div>
          <div class="subheading">Shipping Address</div>
          <label for="shipAddr1">Address Line 1 *</label>
          <input type="text" id="shipAddr1" />
          <label for="shipAddr2">Address Line 2 (optional)</label>
          <input type="text" id="shipAddr2" />

          <label>City, State, Zip *</label>
          <div class="row-3">
            <input type="text" id="shipCity" placeholder="City" />
            <input type="text" id="shipState" placeholder="State" />
            <input type="text" id="shipZip" placeholder="Zip" />
          </div>

          <label>Contact info *</label>
          <input type="text" id="shipContactName" placeholder="Contact Name" />
          <input type="text" id="shipContactPhone" placeholder="Contact Phone Number" />
          <input type="text" id="shipContactEmail" placeholder="Contact Email" />
        </div>

        <!-- Billing Address -->
        <div>
          <div class="subheading">Billing Address</div>

          <div class="inline-checkbox" style="margin-top:0;">
            <input type="checkbox" id="billingSameAsShipping" />
            <label for="billingSameAsShipping" style="margin:0;">Billing same as shipping</label>
          </div>

          <label for="billAddr1">Address Line 1 *</label>
          <input type="text" id="billAddr1" />
          <label for="billAddr2">Address Line 2 (optional)</label>
          <input type="text" id="billAddr2" />

          <label>City, State, Zip *</label>
          <div class="row-3">
            <input type="text" id="billCity" placeholder="City" />
            <input type="text" id="billState" placeholder="State" />
            <input type="text" id="billZip" placeholder="Zip" />
          </div>

          <label>Contact Info (for AP) *</label>
          <input type="text" id="billContactName" placeholder="Contact Name" />
          <input type="text" id="billContactPhone" placeholder="Contact Phone Number" />
          <input type="text" id="billContactEmail" placeholder="Contact Email" />
        </div>
      </div>

      <!-- Tax / County -->
      <div style="margin-top:0.75rem;">
        <div class="inline-checkbox">
          <input type="checkbox" id="taxExempt" />
          <label for="taxExempt" style="margin:0;">Customer is tax exempt</label>
        </div>

        <div id="countyRow" style="margin-top:0.4rem;">
          <label for="county">County (only if not tax exempt) *</label>
          <input type="text" id="county" />
        </div>
      </div>
    </div>
  </div>

  <!-- Master quote right above item list -->
  <div class="card" id="masterQuoteCard" style="display:none;">
    <h2 style="font-size:1.1rem;margin-top:0;">Master Quote</h2>
    <p class="note" id="masterQuoteNote"></p>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Code</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody id="masterQuoteBody"></tbody>
    </table>
  </div>

  <div class="card">
    <h2 style="font-size:1.1rem;margin-top:0;">Items</h2>
    <p class="note">Check the items being ordered and enter quantities.</p>

    <!-- Sticky header area -->
    <div class="sticky-header">
      <button class="btn" style="margin-top:0;" onclick="generateEmail()">
        Generate Email
      </button>

      <!-- Search bar -->
      <label for="itemSearch" style="margin-top:0.6rem;">Search items</label>
      <input
        id="itemSearch"
        type="text"
        placeholder="Type to filter by name, code, or UOM"
        style="margin-bottom:0.3rem;"
      />
    </div>

    <!-- Items table: now wired to .items-table styles -->
    <table class="items-table">
      <thead>
        <tr>
          <th>âœ”</th>
          <th>Item</th>
          <th>Code</th>
          <th>UOM</th>
          <th>Qty</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody id="itemsTableBody">
        <tr><td colspan="6">If you can see this, JavaScript did not run.</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Manage customers overlay -->
  <div id="manageCustomersOverlay">
    <div class="card" id="manageCustomersPanel">
      <h2 style="font-size:1.1rem;margin-top:0;">Manage customers</h2>
      <p class="note">
        View or remove saved customers and their master quotes. To update pricing,
        select a customer on the main screen and adjust prices there, or use Edit
        below. Changes save when you generate an order or when you click Save here.
      </p>
      <table class="manage-table">
        <thead>
          <tr>
            <th>Customer</th>
            <th style="width:70px;">Items</th>
            <th style="width:140px;">Actions</th>
          </tr>
        </thead>
        <tbody id="manageCustomersBody">
          <!-- filled by JS -->
        </tbody>
      </table>

      <!-- Editable master quote section -->
      <div id="editCustomerSection" style="display:none;">
        <h3>Edit master quote for <span id="editCustomerName"></span></h3>
        <table class="manage-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Code</th>
              <th>Price</th>
              <th style="width:70px;">Remove</th>
            </tr>
          </thead>
          <tbody id="editCustomerBody">
            <!-- rows added by JS -->
          </tbody>
        </table>
        <div class="manage-actions">
          <button type="button" class="small-btn" onclick="saveEditedCustomerQuote()">
            Save
          </button>
          <button type="button" class="small-btn" onclick="cancelEditCustomer()">
            Cancel
          </button>
        </div>
      </div>

      <div class="manage-actions">
        <button type="button" class="small-btn" onclick="exportCustomerData()">
          Export
        </button>
        <button type="button" class="small-btn" onclick="document.getElementById('importFile').click();">
          Import
        </button>
        <button type="button" class="small-btn" onclick="closeManageCustomers()">
          Close
        </button>
      </div>

      <input type="file" id="importFile" accept="application/json,.json" style="display:none;">
    </div>
  </div>

  <!-- External JS -->
  <script src="app.js"></script>

</body>
</html>
